<%- include ../header.ejs %>
<main>
  <section id="search">
    <div class="container">
      <div class="row">
        <form class="col s12" action="/inspirations" method="POST">
          <div class="row">
            <div class="input-field col s6">
              <input id="departure-city" type="text" class="validate">
              <label for="departure-city">Departure City</label>
            </div>
            <div class="input-field col s6">
              <input id="destination" type="text" class="validate">
              <label for="destination">Destination (Optional)</label>
            </div>
          </div>
          <div class="row">
            <div class="col s12">
              <input type="button" onclick="submitInspirationSearch()" class="btn white-text" value="Search!">
            </div>
          </div>
        </form>
      </div>
    </div>
  </section>
  <section id="destination-display">
      <!-- destination -->
  </section>

  <!-- underscore template for destination view -->
  <script type="text/template" id="destination-template">
      <div class="parallax-container">
        <div class="parallax"><img src="https://i.imgur.com/DtAdAcZ.jpg"></div>
      </div>
      <div class="section white">
        <div class="row container">
          <button id="edit-search" onclick="editSearch()" class="btn">Edit Search!</button>
          <h2 class="header"><%%= currentDestination.destination %></h2>
          <p class="grey-text text-darken-3 lighten-3">Lorem ipsum dolor sit amet, nec vivendum maiestatis ut, no has tale suas comprehensam. Id sit tota mundi, sint consetetur cu ius, no eam justo sonet conceptam. Mei cu volutpat posidonium, laudem aliquip vis ea, mea an suas falli delicatissimi. Mea quas insolens ad, justo expetendis ex usu. Eam harum graece adipiscing ne, omittam atomorum signiferumque at mei, inani invenire maiestatis vel ut. No graece populo nominati vix, an vis simul iudico integre. Ex ius timeam appareat voluptatibus. Ut sea integre laboramus, ad nec nominavi iracundia, vel quidam invenire eu. Recteque patrioque appellantur sed te, ut has quaeque democritum, ut integre assentior rationibus quo.</p>
        </div>
      </div>
  </script>

</main>





<script src='https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js'></script>
<script>
  var destinationResults;
  var currentDestination;
  var screenMode = "search";
  var template = _.template($('#destination-template').html());

  function render() {
    if (screenMode === "search") {
      return;
    } else if (screenMode === "destinationView") {
      $('#search').hide();
      $('#destination-display').html(template({currentDestination})).show();
      $('.parallax').parallax();
    } else if (screenMode === "editSearch") {
      $('#search').show();
      $('#destination-display').hide();
    }
  }
  
  function submitInspirationSearch() { 
    if ( !$('#departure-city').val() ) return;
    
    fetch('/inspiration', {
      method: 'POST',
      credentials: 'include',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ origin: $('#departure-city').val(), destination: $('#destination').val() })
    })
    .then(res => res.json())
    .then(data => {
      destinationResults = data.results;
      currentDestination = destinationResults[0];
      screenMode = "destinationView";
      render();
    });
  }

  function editSearch() {
    screenMode = "editSearch";
    render();
  }
  // $(document).ready(function(){
  //     $('.parallax').parallax();
  //   });
</script>



<%- include ../footer.ejs %>